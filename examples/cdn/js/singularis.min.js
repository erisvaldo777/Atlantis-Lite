crud=function(tb)
{

  var parametro;
  var ajax_send=false;
  this.set_ajax_send=function(boolean){
    this.ajax_send=boolean;
  };
//SÓ NÚMEROS
 this.soNumeros = function(str) 
{       
    return str.replace(/[^0-9]/g,'');
}
  /*DEBUG FORMDATA*/
  this.fdd=function (args){
    console.log('%c          INÍCIO: FORM-DATA               ','background:#FFF; color:blue;');
    for (var pair of args.entries()) {
     console.log(pair[0]+ ': ' + pair[1]); 
   }
   console.log('%c           FIM: FORM-DATA                   ','background:#FFF; color:blue;');
 };
 /*FUNÇÃO AJAX OTIMIZADA*/
 this.ajax=function(args){
  $.ajax({
    data        : args.data,
    type        : args.type, 
    dataType    : args.dataType,
    url         : args.url,
    processData : false,
    contentType : false,
    beforeSend:function () {
      var beforeSend = args.beforeSend;
      if ($.isFunction(beforeSend))
      {
        beforeSend.call(this,args.data);
      }
    }
  }).done(function(data) {

    var done = args.done;
    if ($.isFunction(done))
    {
      done.call(this,data);
    }

  }).fail(function(jqXHR, textStatus, errorThrown) {    
    var fail = args.fail;
    if ($.isFunction(fail))
    {
      fail.call(this,textStatus);
    }
  });    
  return this;
}


this.data=function(d) 
{
  var nDt='';
  /*SE IGUAL A 00/00/0000 00:00:00*/
  if(d.length>10&&d.indexOf('/')>0){
    var nd=d.split(" ");     
    var nd2=nd[0].split("/");     

    nDt= nd2[2]+"-"+nd2[1]+"-"+nd2[0]+' '+nd[1]; 

    /*SE IGUAL A 00/00/0000*/  
  }else if(d.indexOf('/')>0&&d.length==10){
    var nd=d.split("/");     

    nDt= nd[2]+"-"+nd[1]+"-"+nd[0];  

  }else if(d.indexOf('-')>0&&d.length>10){      
    var nd=d.split(" ");     
    var nd2=nd[0].split("-");     

    nDt= nd2[2]+"/"+nd2[1]+"/"+nd2[0]+' '+nd[1]; 

  }else if(d.indexOf('-')>0){
    var nd=d.split("-");     

    nDt= nd[2]+"/"+nd[1]+"/"+nd[0]; 
  }else if(d=='0000-00-00'){
    nDt='';
  }else{
    nDt='';
  }
  return nDt;

}

/*SINGULAR*/

this.length=function(args){
  console.log('%c >_ Singularis::length: ', 'background: #ccc; color: blue'); 
  var r=0;   

  if(args==undefined){
    r=0;      
  }else if(typeof(args)==='object'&&Object.keys(args).length>0&&args.length!=undefined){
    r=args.length;      
  }else{
    r=1;
  }

  return r;
}

/*VAI SE TORNAR OBSOLETO A PARTIR DE 08/10/2019*/
this.filtrar=function(j,args){
    //console.log('%c >_ Singularis::filtrar: ', 'background: #ccc; color: blue',j,args);         
    var key=Object.keys(args);  

    console.log('key',key);
    
    var data_filter = j.filter( element => element[key[0]]==args[key[0]]);  
    
    //console.log('%c >_ Singularis::filtrar::data_filter', 'background: #ccc; color: blue',data_filter);         
    
    return data_filter;
    
    
  }

  this.filter=function(j,args){
    //console.log('%c >_ Singularis::filtrar: ', 'background: #ccc; color: blue',j,args);         
    var key=Object.keys(args);  

    /*console.log('key',key);*/
    
    var data_filter = j.filter( element => element[key[0]]==args[key[0]]);  
    
    //console.log('%c >_ Singularis::filtrar::data_filter', 'background: #ccc; color: blue',data_filter);         
    
    return data_filter;
    
    
  } 

/*
ESTA FUNÇÃO PEGA OS COOKIES INFORMADOS*/
this.getCookie=function(name) {
  var cookies = document.cookie;
  var prefix = name + "=";
  var begin = cookies.indexOf("; " + prefix);
  
  if (begin == -1) {

    begin = cookies.indexOf(prefix);
    
    if (begin != 0) {
      return null;
    }
    
  } else {
    begin += 2;
  }
  
  var end = cookies.indexOf(";", begin);
  
  if (end == -1) {
    end = cookies.length;                        
  }
  
  return unescape(cookies.substring(begin + prefix.length, end));
}

this.procurar=function (j,args) {
  console.log(j,args);
  var key=Object.keys(args);  
  console.log('key',key);
  console.log('args[key[0]]',args[key[0]]);



  return  j.filter(elem=>elem.turma>'-T#C') ;

};
this.getSingular=function (args){
  console.log('>_Singularis.js::getSingular'); 
  var value='';
  var label='';    

  $($('[data-singular="id_curso"]')).append('<select class="form-control" id="id_curso" name="id_curso"  required></select>');  


  $.each(args.array,function(index,name){    

    if(!args.reg){
      value=args.array[index].id;
      label=args.array[index].valor;
    }else{
      value='aa';
      label='bb';
    }


    $(args.target).append('<option value="'+value+'">'+label+'</option>');
  });
}
this.beforeSend=function(args=null){
  if(this.ajax_send==true){
    return false;
  }
  this.ajax_send=true;
};
this.ls=function(args){
  return JSON.parse(localStorage[args.obj]);
}

this.filterJsonRegedit=function(j,v) {
  var data_filter = j.filter( element => element.value ==v);
  return data_filter[0].label;
}
this.filterJson=function(j,v) {
  var data_filter = j.filter( element => element.value ==v);

  return data_filter[0].label;

}
this.filterJsonByLabel=function(j,v) {
  var data_filter = j.filter( element => element.label ==v);

  return data_filter;

}
this.maskMoeda=function(v,args=[]){
  var value   =   parseFloat(v);

  if(args.padrao=='BR'){
    value=v.replace(".",",");

  }
  if(args.padrao!=undefined){
    value = value.toLocaleString();
  }

  if(args.simbolo!=undefined){
    value = args.simbolo+value;
  }
  if(value=='0'){
    value='0.00';
  }   
  if(value=='NaN'){
    value='';
  }
  return value ;
}
this.soma=function(v1,v2,args){
  var v1      =   parseFloat(v1);
  var v2      =   parseFloat(v2);
  var value   =   0.00;
  var calculo =   v1+v2;

   /*
TORNAR OBSOLETO
    if(args.decimal!=undefined){
      value = calculo;
    }

    if(args.milhar!=undefined){
      value = calculo;
    }*/

    if(args.padrao=='BR'){
      value = calculo.toLocaleString('pt-BR');
    }
    if(args.padrao!=undefined){
      value = calculo.toLocaleString();
    }

    if(args.simbolo!=undefined){
      value = args.moeda+calculo;
    }   

    if(value=='NaN'){
      value='';
    }
    return value;
  }
  /*NESTE MÉTODO DEVE SER ENVIADO APENAS UM ARRAY COM UM OBJETO*/
  this.each=function(json,args){

    $.each(json, function (k, v) {  
//console.log('v',v);
var tag=$(args.seletor+" #"+k);  
/*se for campo de data*/  

if(v=='0000-00-00'){
  tag.val(''); 
}else if(tag.attr("data-inputmask")=="'mask':'99/99/9999'"){ 
  var data=v.split("-"); 
  tag.val(data[2]+"/"+data[1]+"/"+data[0]);       
}else if(tag.attr("data-inputmask")=="'mask':'99/99/9999 99:99:99'"){   
  var data=v.split("-"); 
  tag.val(data[2]+"/"+data[1]+"/"+data[0]+" "+data[3]+":"+data[4]); 
}else if(tag.prop("tagName")=="RADIO"&&tag.hasClass("no-change")==false){ 
  tag.val(v); 
  tag.prop("checked", true);

}else if(tag.prop("tagName")=="SELECT"&&tag.attr("data-change")!=undefined){ 
  tag.val(v); 
}else{ 
  tag.val(v); 
}  

}) 
  }

  this.loading_now=function(args){
    console.log('objeto.loading_now');

    /*GATILHO SHOW DO MODAL - MODAL-CRUD*/ 
    /*Este componente pode somente liberar o formulário, não podendo assim ser feito um reset nele*/
        /*
            var button = e.relatedTarget; 

            
            $('#modal-crud #disciplina').val($(button).closest('tr').data('disciplina'));*/


            $.each(args.seletor.data(), function (name, value) { 
              var tag=$(args.target+" #"+name); 


              /*se for campo de data*/ 
              if(tag.attr("data-inputmask")=="'mask':'99/99/9999'"&&tag.not('disabled')){  
                var data=value.split("-");
                tag.val(data[2]+"/"+data[1]+"/"+data[0]);  
              }else if(tag.attr("data-inputmask")=="'mask':'99/99/9999 99:99:99'"&&tag.not('disabled')){  
                var data=value.split("-");
                tag.val(data[2]+"/"+data[1]+"/"+data[0]+" "+data[3]+":"+data[4]);
              }else if(tag.prop("tagName")=="SELECT"&&tag.attr("data-change")!=undefined&&tag.not('disabled')){
                tag.val(value);
              }else{
                tag.val(value);
              } 

            }) 

            

            $('#form-grade_curricular .form-control').attr('disabled',false);

          }

          this.selectOptions=function(args) 
          {
            console.log('>_ Singularis->selectOptions(): ',args);
            $.each(args.array,function(k,v){
              console.log(k,v);
              var selected= $(args.seletor).data('selected')==v.id ? 'selected ' : '' ;
              $(args.seletor).append('<option '+selected+'value="'+v.id+'">'+v.valor+'</option>');  
            })
          }

          this.converteDatfa=function(dt) 
          {
            var split="'/'";
            var divisor="'-'";

            if(dt.indexOf('-')>0){
              divisor="'/'";           
              split="'-'";
            }
            var dtSplit=dt.split(split);
            var nDt = dtSplit[2]+divisor+dtSplit[1]+divisor+dtSplit[0];

            return nDt;
          }
          this.setParametro=function(param) 
          {

           var query = location.hash.slice(1);
           
           var partes = query.split('#');


           var partes = partes[0].split('?');     
           var partes = partes[1].split('&');           
           
           

           var data = {};

           partes.forEach(function (parte) 
           {


            var chaveValor = parte.split('=');
            var chave = chaveValor[0];
            var valor = chaveValor[1];

            data[chave] = valor;
          });
           return data[param];
           
         };

         this.getParametro=function(r)
         {
          return this.setParametro(r);

        };


        this.getBotoesAcoes=function(elemento)
        {


          var parAtual=this.getParametro('acao');
/*Alterações feitas:
- 10/04/2018 : Foi retirada o atributo: disabled do Botão Editar devido a necessidade da página academico/matricula-curricular-matriculas.php
*/

};
this.setImg=function(args){
  console.log('_> Singularis.min::setImg');
  var imgPerfil=$(args.img_class);

  imgPerfil.attr('src',args.img_path+args.img_name+".jpg");
  /*classNotRemoveImg: Caso não queira que a imagem seja substituida se nao for entregue*/
  if(args.classNotRemoveImg==true){
    imgPerfil.addClass('not-remove-img');  
  }
  
  $(imgPerfil).on('error', function(){
    console.log('erro: não encontrado');
    $(imgPerfil).attr('src',args.img_path+"no-img.jpg");
  });

};
this.setBloqTabs=function()
{
  /*AQUI PÕES COMO TAB PRINCIPAL, A PRIMEIRA*/
  if(this.parametro['acao']=='EDITAR'){
    $('.nav-tabs li').addClass('disabled');
  }
}
/*
@param lkjhlkjhlkjhlkjhlkjh
*/

this.modalAlert=function(args)
{
  var arrayObj=[
  {alerta_tipo:'reg_existente',msg:'Registro duplicado',classe:'alert-danger',icone:'fa fa-hand-paper-o'},
  {alerta_tipo:'erro_sql',msg:'Erro interno no Banco de Dados. \n Se persistir procure o ADMINISTRADOR',classe:'alert-warning',icone:'fa fa-thumbs-o-down'},
  {alerta_tipo:'erro_param',msg:'Há dados incompletos.',classe:'alert-warning',icone:'fa fa-hand-paper-o'},
  {alerta_tipo:'sucesso',msg:'Salvo com sucesso!',classe:'alert-success',icone:'fa fa-thumbs-o-up'},
  {alerta_tipo:'atualizado',msg:'Dados atualizados com sucesso!',classe:'alert-primary',icone:'fa-thumbs-o-up'},
  {alerta_tipo:'',msg:'Nossos robôs não conheceram esse erro!. Procure o ADMINISTRADOR.',classe:'alert-warning',icone:'fa fa-bug'},
  {alerta_tipo:'erro_sqlexcept',msg:'Erro de Estrutura. \n Comunique o ADMINISTRADOR urgentemente',classe:'alert-warning',icone:'fa fa-thumbs-o-down'},
  {alerta_tipo:'person',msg:args.msg,classe:args.classe,icone:args.icone},
  ];

  var modal='#modal-alert';

  $.each(arrayObj,function (index, value) 
  { 
    if(value.alerta_tipo==args.alerta_tipo){
      $(modal+' .modal-header').removeClass('alert-danger alert-warning alert-success');
      $(modal+' .modal-body p').html('<i class="'+value.icone+'"></i> '+value.msg);
      $(modal+' .modal-header').addClass(value.classe);
      $(modal).modal('show');
    }
  }); 

  var callback = args.callback;
  if ($.isFunction(callback))
  {
    var parameter = 'Reload';
    callback.call(this, parameter);
  }
  return this;
}

this.resetForm=function(form)
{/*Resetar formulario*/
  console.log('%c >_ Singularis->resetForm(): ','background: #FFF; color: blue');
  $(form).validate().resetForm();
  $(form+" .form-control:not('.not-empty')").removeClass("error");
  $(form+" input:not('.not-empty'),"+ form+" select:not('.not-empty')").val("");
  $(form+" .primary_key").val("0");
}

this.refresh=function(args={})
{
  /* PARAMETROS
  *
  * refresh = Usado para indicar se a tela vai ler a location.hash atual | padrao null
  *
  */
  console.log('%c >_ Singularis.refresh: ', 'background: #ccc; color: blue'); 

  $('body').removeClass('modal-open');
  $('.modal-backdrop').remove();

  if(args.refresh!=false){
    console.log('refreshow');
    var url = location.hash;
    var hash = url.split("#")[1];          
    $('.view-load').load('../'+hash);  
  }
}

this.reload=function()
{
  console.log('%c >_ Singularis.reload: ', 'background: #ccc; color: blue');      
  location.reload(); 
  
}
/*AQUI SERVE PARA MUDAR AS TABS*/
this.mudaTab=function(args)
{  

  if(args.retorno_bd=="ATUALIZADO"||args.retorno_bd>0||args.retorno_bd=="SUCESSO"){
    $("body").on("click","#modal-alert #refresh-tab", function()
    {
      $('.modal').modal('hide');

      $(args.target).tab("show");

    });

  }
  console.log('>_ Singularis.mudaTab');      

}

this.modalConfirmClose=function(args)
{
  $("body").on("click","#modal-btn-si", function()
  {    
    $("#modal-confirm").modal('hide');          
  });

  if(args.refresh=='onUpdate'||args.refresh=='onInsert')
  {
    window.location.href="curso.php";
  }
  console.log('>_ Singularis.modalConfirmClose');  
}

this.modalConfirm=function()
{  
  var modal_body='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="modal-confirm">  <div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header alert-success"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="modal-crudLabel">Atualizado com suceso!</h4>      </div>      <div class="modal-footer"><button type="button" class="btn btn-info" id="modal-btn-si">fechar</button></div></div></div></div>';

  $(".sing-modal-confirm").append(modal_body);
  $("#modal-confirm").modal('show');
  $("#modal-crud").modal('hide');
};

this.modalMonitoramento=function(){

  $('body').append('<div class="modal fade" id="modal-monitoramento"> '+
    '    <div class="modal-dialog"> '+
    '        <div class="modal-content"> '+
    '            <div class="modal-header bg-primary">               '+
    '                <h4 class="modal-title">MONITORAMENTO</h4> '+
    '            </div> '+
    '            <div class="modal-body"> '+
    '                <p></p> '+
    '            </div> '+
    '            <div class="modal-footer"> '+
    '                <button type="button" class="btn btn-primary" data-dismiss="modal">Ok!</button> '+
    '            </div> '+
    '        </div><!-- /.modal-content --> '+
    '    </div><!-- /.modal-dialog --> '+
    '</div> '+
    '<!-- /.Modal Alert --> ');
}

this.returnData=function(input,args) 
{/*js/validados-grade-curricular*/
  console.log('>_ Singularis.returnData');  
  var arrayData=[];
  $.each(args,function(index,element){

    $(input).attr('data-'+index,'"'+element+'"');

  })

};
this.loadView=function(args) 
{/*js/validados-grade-curricular*/

  $(args.div).load(args.url,{'param_sql':args.param_sql},function(){

  });
};


this.carregaCidade=function(args) 
{
  var $this=$(args.seletor);
  $this.prepend('<option>Carregando...</option>');
  
  $this.html('');
  $.ajax({
    data: {'hash':'7647aa4377a28a5feb8cf60667fe1302','chave':args.chave},
    type : "post", 
    dataType: 'json',
    async:false,
    url: '../../../php/Hashs.php'
  }).done(function(dataJson) {
    $.each(dataJson,function(k,v){
      $(args.seletor).append('<option value="'+v.id_cidade+'">'+v.cidade+'</option>');        
    });       
    console.log('args.selecionado',args.selecionado);  
    $this.val(args.selecionado);
  }).fail(function(jqXHR, textStatus, errorThrown) {

   console.log('%cERRO COMPONENTE:: Hash:','background:#ff3300; color:#fff');
 })

};

this.limpaForm=function(args){
  console.log('>_ Singularis.limpaForm');  
  /*AQUI VERIFICA SE EXISTE UM MODAL ABERTO*/
  /*var modal_open  =$('body').hasClass('modal-open');
  var estaAcao    =$(this).data('acao');
  var modal       =modal_open==false?'#'+$('.tab-pane.active').attr('id'):'.modal[aria-hidden="false"]';
  var form        =$(this).closest("form");
  var error       =$(modal).find(".error")

  $("input:not('.not-empty'),select:not('.not-empty')").val("");
  form.find('.form-control').attr('disabled',false);
  $(modal+' button.btn[data-acao="saveReg"]:not(".not-hide"),'+modal+' button.btn[data-acao="cancel"]:not(".not-hide")').removeClass('hide'); */

  $(args+" input:not('.not-empty'),"+args+" select:not('.not-empty')").val("");
}
this.ativaForm=function(form){
  console.log('>_ Singularis.ativaForm');  

  $(form).find('.form-control:not(".primary_key")').attr('disabled',false);
}

this.desativaForm=function(form){
  console.log('>_ Singularis.desativaForm');  
  this.limpaForm(form);
  $(form).find('.form-control').attr('disabled',true);   
}

$(function(){

  /*ESTA CLASSE É DEFINITIVA*/

  $('body').on('keyup',".form-control",function(e) {
    if(e.keyCode>48&&e.keyCode<105||e.keyCode==8||e.keyCode==186||e.keyCode==32){
      $('.btSalvar').attr('disabled',false);
    }
  });

  $('body').on('change',".form-control",function(e) {  
    $('.btSalvar').attr('disabled',false);
  });



  $('body').on('click','[data-acao]',function(){

    /*AQUI VERIFICA SE EXISTE UM MODAL ABERTO*/
    var modal_open  =$('body').hasClass('modal-open');
    var estaAcao    =$(this).data('acao');
    var modal       =modal_open==false?'#'+$('.tab-pane.active').attr('id'):'.modal[aria-hidden="false"]';
    var form        =$(this).closest("form");
    var error       =$(modal).find(".error")

    console.log('>_ Singularis.data-acao »» form utilizado: '+form);
    console.log('>_ Singularis->[data-acao]');
    console.log('>_ Singularis.data-acao »» '+estaAcao);
    console.log('>_ Singularis.data-acao »» var.modal »» '+modal);


    //$(this).addClass('hide');/*VER SE ISSO PODERÁ SER APLICADO*/      
    if(estaAcao=='cancel'){      
      $(modal+' button.btn[data-acao="saveReg"]:not(".not-hide"),'+modal+' button.btn[data-acao="cancel"]:not(".not-hide")').addClass('hide');
      $(modal+' button.btn[data-acao="addReg"]').removeClass('hide');
      $(modal+' button.btn[data-acao="editReg"]').removeClass('hide');
      $(modal+" input:not('.not-empty'),"+ modal+" select:not('.not-empty')").val("");
      $('.profile-user-img:not(".not-remove-img")').attr('src','../../imagens/site/no-img.jpg');/*otimizar repetido*/
      $(modal).modal('hide');
      form.find('.form-control:not(".not-disabled")').attr('disabled',true);
    }
    if(estaAcao=='addReg'){/*VERIFICAR SE TEM OPÇÕES QUE O BT_NOVO DEVE PERMANECER ATIVO CASO PRECESE A SOLUCAO SERIA CRIAR UMA CLASSE OU BOTOES INDIVIDUALIZADOS*/
      $(modal+" input:not('.not-empty'),"+ modal+" select:not('.not-empty')").val("");
      form.find('.form-control').attr('disabled',false);
      $(modal+' button.btn[data-acao="saveReg"]:not(".not-hide"),'+modal+' button.btn[data-acao="cancel"]:not(".not-hide")').removeClass('hide');      
      $('.profile-user-img:not(".not-remove-img")').attr('src','../../imagens/site/no-img.jpg');/*otimizar repetido*/
      $(':not(".not-hide")',this).addClass('hide');
      $('input.primary_key').val('0');
      console.log('>_ Singularis.data-acao »» estaAcao==addReg');
    }    

    if(estaAcao=='saveReg'&&error==false){
      $(modal+' button.btn[data-acao="saveReg"]').addClass('hide');
      $(modal+' button.btn[data-acao="addReg"]').removeClass('hide');
    }
    if(estaAcao=='editReg'){
      $($(this).not(".not-hide")).addClass('hide');
      $(modal+' button.btn[data-acao="saveReg"],'+modal+' button.btn[data-acao="cancel"]').removeClass('hide');
      $(modal+' button.btn[data-acao="addReg"]:not(".not-hide")').addClass('hide');
      form.find('.form-control').attr('disabled',false);
    }


  });
  
  
  /*$('.nav-tabs a').on('show.bs.tab',function(event){    
    var tab_load    = $(event.target).data('tab-load');    
    // if((tab_load==undefined||tab_load==false)&&($('.primary_key').val()>0)||$('.primary_key').val()!=$('.index').val()){
      console.log(tab_load);
      if(tab_load!==undefined){
        carregaViaAjax({tb:$(event.target).attr('href'),url:'carrega-form-via-ajax.php',key:$('.primary_key').attr('id'),value:$('.primary_key').val()});      
        $(this).attr('data-tab-load','true');/*AQUI INDICA SE O TAB-PANE JA FOI LIDO UMA VEZ      

        console.log('>_carregaViaAjax');

      }  
    });*/



    $('[data-moeda]').on('keyup',function(){    
    //var numero=$(this).val();
    /*
      var numero = numero.split('.');
      numero[0] = numero[0].split(/(?=(?:...)*$)/).join('.');
      $(this).val(numero.join(','));*/

    });

    $('.tasks-menu-mon').click(function(){    
      $('#modal-monitoramento').modal('show');
      var view_monitoramento=$('#modal-monitoramento .modal-body p');
      view_monitoramento.html('Carregando...'+this.id);
      view_monitoramento.load('../../php/load-monitoramento.php',{'array':this.id},function(){


      });

    }) 


    $('.search-panel').on('click','ul li',function(){
      console.log('>_ Singularis->search-panel()');
      $this = $('.search-panel');
      $this.find('ul li').removeClass('active');    
      $this.find('button span#search_options').text('Filtrar por: '+$(this).text());    
    //$this.data('search_page',$(this).data('search_page_target'));
    $(this).addClass('active');
  });

    $("body").on('click',"[data-modal-load]",function(){
      console.log('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~');
      console.log('>_Singularis.js::click->[data-modal-load]');
      console.log('Inicia processo...');

      var $thisId=this.id;
      var $modal='.modal#'+$thisId;
      var modalValue=$(this).data('modal-load');
      console.log('modalValue:',modalValue);
      if($($modal).length==0){  
        var objSel=new load_select();
        console.log('processo 1');

        $.ajax({
          data: {},
          type : "post", 
          dataType: 'html',
          url: '../modal/'+$thisId+'.html'
        }).done(function(data) { 

          $('body').append(data);
          $($modal).modal('show');
//          $("[data-mask]").inputmask();   

objSel.load($modal);
loadDados(modalValue);
}).fail(function(jqXHR, textStatus, errorThrown) {
  /**/
  console.log(textStatus + ': ' + errorThrown);
});modalValue


}else{
  console.log('processo 2');
  $($modal).modal('show');
  loadDados(modalValue);

}

});

  })



}

$.fn.onchange = function(args) {

  $(this).on("change",function(){      

    console.log('args',args);
    
    var target          =  $(this).data("onchange");
    var value           =  $(this).val();        
    var value_selected  =  $(target).val();
    var hash            =  $(this).data("hash");

    var chaves={};


    var obj = {
      hello: function( name ) {

        if(value!=""){
          $(target).html('<option value="">Carregando...</option>');

          $.ajax({
            data: {'hash':args.hash,'chave':chaves},
            type : "post", 
            dataType: 'json',
            url: "../../../php/Hashs.php"
          }).done(function(data) {    
            console.log('target',target);
            console.log('data onChange',data);
            $(target).html('');   
            

            var callback = args.callback;
            if ($.isFunction(callback))
            {

              callback.call(this, data);
            }
            return this;

          }).fail(function(jqXHR, textStatus, errorThrown) {

            console.log(textStatus + ': ' + errorThrown);
          });    

        }
      },pega_array:function(){

        $.each(args.chave[0],function(k,v){

          chaves[k]=$(v).val();
        });
      }
    },

    defer = $.Deferred();
    defer.promise( obj );
    defer.resolve( "John" );
    obj.done(function( name ){
      obj.pega_array( name );
    }).hello( "Karl" ); 



    console.log('args.chave',chaves);



  });


};


$.fn.dataChange = function(args) {  
  $(this).on("change",function(){      
    console.log('Change');         
    var target          =  $(this).attr("data-change");
    var value           =  $(this).val();        
    var value_selected  =  $(target).val();

    
    if( $(this).is(':visible') ){
      console.log('ESTÁ VISIVEL');
      if(value!=""){
        $(target).html('<option value="">Carregando...</option>');
        $.ajax({
          data: {
            tb              :"tb_cidade",
            key             :"id_uf",
            value           :value,
            col_select      :'id_cidade',
            value_selected  :value_selected,
            return          :"cidade",
            no_bloco        :true

          },
          type : "post", 
          dataType: 'json',
          url: "../../../php/data-change.php"
        }).done(function(data) {    
          $(target).html('');
          $.each(data,function(k,v){
            $(target).append('<option value="'+v.id_cidade+'">'+v.cidade+'</option>');  
          })


        }).fail(function(jqXHR, textStatus, errorThrown) {

          console.log(textStatus + ': ' + errorThrown);
        });    
      }
    }

  }).trigger("change");   
};

/*CHANGE SERÁ USADO PARA EXECUTAR ACÇÕES NO MOMENTO Q UM CHANGE EH ALTERADO*/
$.fn.newChange = function(args) {  
  $(this).on("change",function(){      

    var target          =  $(this).data("new_change");
    var value           =  $(this).val();        
    var value_selected  =  $(target).val();

    var callback = args.callback;
    if ($.isFunction(callback))
    {

      callback.call(this, this);
    }
    return this;
    

  }).trigger("change");   
};
singularis=new crud(null);